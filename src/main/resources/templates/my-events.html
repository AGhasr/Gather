<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Events - Gather</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
</head>
<body class="bg-body">

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mt-5">

  <div th:if="${param.message}" class="alert alert-success alert-dismissible fade show border-0 shadow-sm" role="alert">
    <i class="fas fa-check-circle me-2"></i>
    <span th:text="${param.message}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div class="d-flex justify-content-between align-items-end mb-5">
    <div>
      <h6 class="text-uppercase text-primary fw-bold letter-spacing-1 mb-1">Your Schedule</h6>
      <h2 class="fw-bold text-dark mb-0">My Events</h2>
    </div>
    <span class="badge bg-white text-primary shadow-sm px-3 py-2 rounded-pill border">
        <i class="fas fa-ticket-alt me-2"></i>
        <span th:text="${#lists.size(myEvents)}">0</span> Going
    </span>
  </div>

  <div class="row g-4" th:if="${not #lists.isEmpty(myEvents)}">
    <div class="col-md-6 col-lg-4" th:each="event : ${myEvents}">
      <div class="card h-100 border-0 shadow-card hover-lift">

        <div style="height: 100px; background: linear-gradient(135deg, var(--primary-soft), #ffffff); position: relative;">
            <span class="badge bg-white text-primary shadow-sm position-absolute top-0 end-0 m-3 rounded-pill px-3 py-2">
                <i class="fas fa-users me-1"></i> <span th:text="${event.group.name}">Group</span>
            </span>
        </div>

        <div class="card-body position-relative pt-0 px-4 pb-3">
          <div class="position-absolute top-0 start-0 ms-4 translate-middle-y bg-white border shadow-sm rounded-3 text-center p-2"
               style="width: 65px; height: 65px; display: flex; flex-direction: column; justify-content: center;">
            <span class="d-block text-danger fw-bold small text-uppercase lh-1" th:text="${#temporals.format(event.date, 'MMM')}">JAN</span>
            <span class="d-block h3 fw-bold mb-0 text-dark lh-1" th:text="${#temporals.format(event.date, 'dd')}">01</span>
          </div>

          <div class="mt-4 pt-3">
            <h5 class="card-title fw-bold text-dark mb-2">
              <span th:text="${event.title}">Event Title</span>
            </h5>
            <p class="card-text text-muted small line-clamp-2 mb-3" th:text="${event.description}">
              Description...
            </p>
          </div>
        </div>

        <div class="card-footer bg-transparent border-top border-light px-4 py-3">
          <div class="d-flex justify-content-between align-items-center">

            <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-success-soft text-success rounded-pill px-3 py-2">
                        <i class="fas fa-check-circle me-1"></i> Going
                    </span>

              <form th:action="@{'/cancelRegistration/' + ${event.id}}" method="post"
                    onsubmit="return confirm('Are you sure you want to cancel your registration?');">
                <button type="submit" class="btn btn-link text-muted p-0 text-decoration-none small" title="Cancel Registration">
                  <small>Leave</small>
                </button>
              </form>
            </div>

            <div class="d-flex gap-2">
              <a th:href="@{'/events/' + ${event.id} + '/export'}"
                 class="btn btn-icon btn-light text-secondary rounded-circle"
                 title="Add to Calendar"
                 style="width: 32px; height: 32px; display: grid; place-items: center;">
                <i class="fas fa-calendar-plus"></i>
              </a>

              <a th:href="@{'/groups/' + ${event.group.id} + '/chat'}"
                 class="btn btn-icon btn-light text-primary rounded-circle"
                 title="Group Chat"
                 style="width: 32px; height: 32px; display: grid; place-items: center;">
                <i class="fas fa-comment-dots"></i>
              </a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div th:if="${#lists.isEmpty(myEvents)}" class="text-center py-5">
    <div class="bg-white rounded-circle shadow-sm d-inline-flex align-items-center justify-content-center mb-4"
         style="width: 100px; height: 100px;">
      <i class="fas fa-calendar-times text-muted fa-3x opacity-50"></i>
    </div>
    <h3 class="fw-bold text-dark">No upcoming plans</h3>
    <p class="text-muted mb-4">You haven't registered for any events yet.</p>
    <a href="/" class="btn btn-primary px-4 py-2">
      <i class="fas fa-search me-2"></i>Browse Events
    </a>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>